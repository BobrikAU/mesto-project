(()=>{"use strict";var t={urlCohort:"https://mesto.nomoreparties.co/v1/plus-cohort-9",token:"7f8d2163-5607-4805-9bb9-bec28100308e"},e="popup_opened",o="photos__item",n="button__icon-like_aktive",c="photos__photo",r="photos__caption",a="button__icon-like",u="button_function_trash",i="photos__nummer-likes",s="popup__input-text_error",l="popup__input-error",p="popup__input-text",d="popup__submit_disabled",f="popup__form",_="popup__submit",m=document.querySelector(".".concat("popup_photo")),h=m.querySelector(".".concat("popup__photo")),v=m.querySelector(".".concat("popup__title_photo")),y=document.querySelector(".".concat("photos__list")),S=document.querySelector("#empty-item").content,b=document.querySelector(".".concat("profile__title")),k=document.querySelector(".".concat("profile__subtitle")),q=document.querySelector(".".concat("profile__avatar")),C=document.querySelector(".".concat("popup__edit-profile")),g=C.querySelector(".".concat("popup__name-field")),x=C.querySelector(".".concat("popup__field-yourself")),E=C.querySelector(".".concat(_)),L=document.querySelector(".".concat("popup__edit-avatar")),P=L.querySelector(".".concat(_));function j(t,e,o,n){t.querySelectorAll(".".concat(e)).forEach((function(t){t.textContent=""})),t.querySelectorAll(".".concat(o)).forEach((function(t){t.classList.remove(n)}))}var T,A,D,z,w,I,B=function(t,e){t.classList.add(e),t.setAttribute("disabled","yes")};function N(t){document.removeEventListener("keydown",O),t.classList.remove(e)}function O(t){"Escape"===t.key&&N(document.querySelector(".".concat(e)))}function J(t){t.classList.add(e),document.addEventListener("keydown",O)}function M(e,s,l,p,d,f,_){var y=S.cloneNode(!0),b=y.querySelector(".".concat(c));b.src=l,b.alt=s,y.querySelector(".".concat(i)).textContent=f,y.querySelector(".".concat(r)).textContent=e;var k=y.querySelector(".".concat(o));k.setAttribute("owners_id",p),k.setAttribute("card_id",d);var q=y.querySelector(".".concat(a));if(_&&q.classList.add(_),q.addEventListener("click",(function(e){!function(e){var c=e.target,r="PUT";c.classList.contains("".concat(n))&&(r="DELETE");var a=e.target.closest(".".concat(o));(function(e,o){return fetch("".concat(t.urlCohort,"/cards/likes/").concat(e.getAttribute("card_id")),{method:o,headers:{authorization:t.token}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){return console.log(t),Promise.reject()}))})(a,r).then((function(t){c.classList.toggle("".concat(n)),a.querySelector(".".concat(i)).textContent=t.likes.length}))}(e)})),b.addEventListener("click",(function(t){!function(t,e){var o=t.target.src,n=t.target.alt;h.src=o,h.alt=n,v.textContent=e,J(m)}(t,e)})),k.getAttribute("owners_id")===t.id){var C=y.querySelector(".".concat(u));C.classList.remove("button_hidden"),C.addEventListener("click",(function(e){!function(e){var n,c=e.target.closest(".".concat(o));(n=c,fetch("".concat(t.urlCohort,"/cards/").concat(n.getAttribute("card_id")),{method:"DELETE",headers:{authorization:t.token}}).then((function(t){return t.ok?t:Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){return console.log(t),Promise.reject()}))).then((function(){c.remove()}))}(e)}))}return y}function F(t){y.prepend(t)}Promise.resolve().then((function(){fetch("".concat(t.urlCohort,"/users/me"),{headers:{authorization:t.token}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){return console.log(t),Promise.reject(t)})).then((function(e){b.textContent=e.name,t.id=e._id,k.textContent=e.about,q.src=e.avatar,q.alt="аватар ".concat(e.name)})).catch((function(t){b.textContent="string"==typeof t?t:"Что-то не так",k.textContent="Попробуйте перезагрузить страницу"}))})).then((function(){fetch("".concat(t.urlCohort,"/cards"),{headers:{authorization:t.token}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){return console.log(t),Promise.reject()})).then((function(e){for(var o=[],n=function(){var n=Math.floor(Math.random()*e.length);if(!o.some((function(t){return t===n}))){var c=e[n].link,r="Изображение ".concat(e[n].name),a=e[n].name,u=e[n].owner._id,i=e[n].likes.length,s=e[n]._id,l=void 0;e[n].likes.some((function(e){return e._id===t.id}))&&(l="".concat("button__icon-like_aktive")),F(M(a,r,c,u,s,i,l)),o.push(n)}};o.length<6;)n()})).catch((function(){F(M("Перезагрузите страницу","Что-то пошло не так. Перезагрузите страницу"))}))})),document.querySelector(".".concat("profile__edit-button")).addEventListener("click",(function(){g.value=b.textContent,x.value=k.textContent,B(E,d),j(C,l,p,s),J(C)})),C.querySelector(".".concat(f)).addEventListener("submit",(function(e){!function(e){var o,n;e.preventDefault(),E.textContent="Сохранение...",(o=g.value,n=x.value,fetch("".concat(t.urlCohort,"/users/me"),{method:"PATCH",headers:{authorization:t.token,"Content-Type":"application/json"},body:JSON.stringify({name:o,about:n})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){return console.log(t),Promise.reject()}))).then((function(t){b.textContent=t.name,k.textContent=t.about,N(C),E.textContent="Сохранить"}))}(e)})),T=document.querySelector(".".concat("profile__add-button")),A=document.querySelector(".".concat("popup__add-card")),D=A.querySelector(".".concat("popup__submit")),z=A.querySelector(".".concat(f)),T.addEventListener("click",(function(){B(D,d),z.reset(),j(A,l,p,s),J(A)})),function(e,o,n){o.addEventListener("submit",(function(c){!function(e,o,n,c){var r,a;e.preventDefault(),c.textContent="Сохранение...",(r=n.title.value,a=n.link.value,fetch("".concat(t.urlCohort,"/cards"),{method:"POST",headers:{authorization:t.token,"Content-Type":"application/json"},body:JSON.stringify({name:r,link:a})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){return console.log(t),Promise.reject()}))).then((function(t){F(M(t.name,"Изображение ".concat(t.name),t.link,t.owner._id,t._id,t.likes.length)),N(o),c.textContent="Сохранить"}))}(c,e,o,n)}))}(A,z,D),document.querySelectorAll(".".concat("popup")).forEach((function(t){t.addEventListener("click",(function(t){!function(t){(t.target===t.currentTarget||t.target.classList.contains("".concat("button__icon-close")))&&N(t.currentTarget)}(t)}))})),document.querySelector(".".concat("profile__avatar-container")).addEventListener("click",(function(){var t=L.querySelector(".".concat(f));B(P,d),t.reset(),j(L,l,p,s),J(L)})),L.querySelector(".".concat(f)).addEventListener("submit",(function(e){var o;e.preventDefault(),P.textContent="Сохранение...",(o=L.querySelector(".".concat(p)).value,fetch("".concat(t.urlCohort,"/users/me/avatar"),{method:"PATCH",headers:{authorization:t.token,"Content-Type":"application/json"},body:JSON.stringify({avatar:o})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){return console.log(t),Promise.reject()}))).then((function(t){q.src=t.avatar,q.onload=N(L),P.textContent="Сохранить"}))})),w={classInputTextError:"popup__input-text_error",classInputTextPopups:"popup__input-text",classButtonSubmitDisabled:"popup__submit_disabled",classFromPopup:"popup__form",classButtonSubmit:"popup__submit"},I=function(t){var e=t.target,o=t.target.closest(".".concat(w.classFromPopup)),n=o.querySelector(".popup__input-error-".concat(e.name)),c=o.querySelector(".".concat(w.classButtonSubmit));e.validity.valid?(function(t,e){t.classList.remove(w.classInputTextError),e.textContent=""}(e,n),function(t,e){Array.from(t.querySelectorAll(".".concat(w.classInputTextPopups))).every((function(t){return t.validity.valid}))&&(e.classList.remove(w.classButtonSubmitDisabled),e.removeAttribute("disabled"))}(o,c)):(function(t,e){t.classList.add(w.classInputTextError);var o=t.validationMessage;e.textContent=o}(e,n),B(c,w.classButtonSubmitDisabled))},document.querySelectorAll(".".concat(w.classInputTextPopups)).forEach((function(t){t.addEventListener("input",I)}))})();